# HydroSatKevin Development Context

## Project Overview
HydroSatKevin is a customer feedback system POC with sentiment analysis using AWS Comprehend. Built with React frontend and AWS Lambda backend, deployed via GitHub Actions CI/CD.

## Current Status (End of Session)
- **Backend**: Complete with POST /feedback and GET /viewFeedback endpoints
- **Frontend**: Basic feedback form working, placeholder viewFeedback page created
- **CI/CD**: GitHub Actions pipeline configured, currently troubleshooting AWS deployment
- **Testing**: Basic Jest tests created to unblock pipeline
- **AWS**: Infrastructure defined in SAM template, deployment in progress

## Architecture Summary
- **Frontend**: React + TypeScript + Vite (multi-page: giveFeedback.html, viewFeedback.html, error.html)
- **Backend**: AWS Lambda + TypeScript, DynamoDB, AWS Comprehend
- **Infrastructure**: AWS SAM template with API Gateway, Lambda, DynamoDB, S3
- **CI/CD**: GitHub Actions with AWS credentials and deployment bucket

## Key Technical Decisions
- **Sentiment Mapping**: POSITIVE→Good, NEGATIVE→Bad, NEUTRAL/MIXED→Neutral
- **Idempotency**: Backend-handled using hash of session + feedback text
- **Session Management**: Browser sessionStorage with crypto.randomUUID()
- **Testing Strategy**: Jest for both backend and frontend (simple tests for now)
- **Build Strategy**: TypeScript compilation excludes test files to avoid Jest globals

## AWS Configuration
- **Region**: us-east-1
- **SAM Deployment Bucket**: hydrosatkevin-sam-deployment-1754074648
- **Stack Name**: hydrosatkevin-prod
- **GitHub Secrets**: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION, SAM_DEPLOYMENT_BUCKET

## Recent Issues Fixed
1. **Handler Paths**: Fixed SAM template to use dist/handlers/[file].[function] format
2. **Frontend Build**: Added missing HTML pages, excluded test files from TypeScript compilation
3. **Test Commands**: Fixed GitHub Actions workflow to use correct Jest commands
4. **S3 Policy**: Fixed bucket policy resource reference from ${FrontendBucket} to ${FrontendBucket.Arn}
5. **Vite Types**: Added "vite/client" to tsconfig.json for import.meta.env support

## Current Status (Updated)
- **Deployment Issues Resolved**: Fixed ROLLBACK_COMPLETE handling and S3 bucket output reference
- **Local Development Setup**: Created template-local.yaml for local DynamoDB tables
- **Crypto UUID Issue Fixed**: Added fallback for HTTP contexts (S3 static hosting without HTTPS)
- **Environment Separation**: Production (template.yaml) vs Local (template-local.yaml)
- **Next**: Deploy local tables and test both local and production environments

## File Structure
```
├── backend/
│   ├── src/
│   │   ├── handlers/ (feedback.ts, viewFeedback.ts)
│   │   ├── services/ (dynamodb.ts, comprehend.ts)
│   │   ├── types/ (feedback.ts)
│   │   └── __tests__/ (basic Jest tests)
│   └── package.json
├── frontend/
│   ├── src/
│   │   ├── components/ (FeedbackForm.tsx)
│   │   ├── utils/ (session.ts)
│   │   ├── styles/ (giveFeedback.css)
│   │   └── __tests__/ (basic Jest tests)
│   ├── giveFeedback.html
│   ├── viewFeedback.html
│   ├── error.html
│   └── package.json
├── .github/workflows/deploy.yml
├── template.yaml (AWS SAM - production)
├── template-local.yaml (AWS SAM - local DynamoDB tables)
├── CLAUDE.md (project instructions/work list)
└── Context.md (this file)
```

## API Endpoints (Currently Deployed Locally)
- **POST /feedback**: Submit customer feedback, returns sentiment analysis
- **GET /feedback**: Returns all feedback (should be /viewFeedback)
- **GET /statistics**: Not yet implemented

## Immediate Next Steps
1. Deploy local DynamoDB tables: `cd backend && npm run deploy-local-db`
2. Test local development: `cd backend && npm run local`
3. Test production deployment with fixes applied
4. Fix SAM template endpoint naming (GET /feedback → GET /viewFeedback)
5. Implement GET /statistics endpoint
6. Create proper viewFeedback admin dashboard component
7. Add CloudFront distribution for HTTPS support
8. Write comprehensive unit tests

## Development Environment Setup
- **Setup Local Tables**: `cd backend && npm run deploy-local-db` (one-time setup)
- **Local Backend**: `cd backend && npm run build && npm run local` (SAM at localhost:3000)
- **Local Frontend**: `cd frontend && npm run dev` (Vite at localhost:5173)
- **Testing**: `npm test` in respective directories
- **AWS Credentials**: Configured locally, resolved conflicts with work profiles

## Important Notes
- Always ask user to add to commit messages before committing
- Keep todo list and CLAUDE.md work list synchronized
- Frontend bucket name will be auto-generated by AWS (hydrosatkevin-prod-frontend-{account-id})
- User noted concern about Claude's todo list clarity - maintain better tracking
- Tests must pass before deployment, builds must complete successfully
- User chose GitHub Actions for convenience but noted it's rudimentary vs. multi-stage pipelines

## Dependencies
- **Backend**: AWS SDK v3, uuid, TypeScript, Jest
- **Frontend**: React 18, TypeScript, Vite, Jest, @testing-library
- **AWS**: SAM CLI, AWS CLI configured with IAM user "HydroSat" (Administrator Access)

## User Preferences/Context
- Wants to eventually self-code top-k or similar ML features
- Prefers to be prompted for commit message additions
- Fixed local AWS credential conflicts with work environment
- Values explicit progress tracking and synchronization between todo/work lists